# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Dev Quest is an idle clicker/incremental game with RPG and Tamagotchi mechanics. Built as a Progressive Web App using Vite and vanilla JavaScript (no frameworks).

## Commands

```bash
# Development server with hot reload
npm run dev

# Production build
npm run build

# Preview production build locally
npm run preview
```

## Architecture

### Core Game Loop

The game runs on a 1-second tick interval managed by `startGameLoop()` in `game.js`:

1. **Decay needs** - hunger, energy, happiness, caffeine decrease over time
2. **Generate auto-LoC** - passive income from purchased upgrades
3. **Spawn enemies** - periodic threats that must be defeated
4. **Apply enemy damage** - enemies steal LoC if not handled
5. **Check level up** - convert total LoC into XP and levels
6. **Autosave** - persist to localStorage every 30 ticks

### State Management

- **Centralized state object** containing all game data (LoC, needs, upgrades, level, XP, skills, equipment, enemy state, etc.)
- State is passed by reference to all modules - functions mutate state directly
- Persistence via `localStorage` with key `'dev-quest-save'`
- Safe loading: `initState()` merges saved data with default state to handle new properties

### Module Structure

| Module | Purpose |
|--------|---------|
| `main.js` | Entry point - initializes state, wires up event handlers, starts game loop |
| `game.js` | Core tick logic, state initialization, game loop management |
| `clicker.js` | Manual click mechanics with bonuses from skills/equipment |
| `upgrades.js` | Auto-generators (Intern, Stack Overflow, Claude Code, etc.), cost scaling, output calculation |
| `rpg.js` | Leveling system, XP curves, skills, equipment definitions and purchases |
| `tamagotchi.js` | Needs decay system, feeding items, nap mechanic |
| `enemies.js` | Enemy spawning logic, combat, damage calculation |
| `prestige.js` | "Rewrite" system - reset progress for permanent multipliers |
| `ui.js` | All DOM manipulation, tab system, shop rendering, visual effects (floats, flashes, particles) |
| `save.js` | localStorage persistence (save/load) |
| `sound.js` | Audio feedback for interactions |
| `onboarding.js` | Tutorial flow for first-time players |

### Key Game Mechanics

**LoC (Lines of Code)** - Main currency
- Generated by clicking (manual) or auto-upgrades (passive)
- Used to purchase upgrades, items, and equipment

**Needs System** - Four stats that decay over time:
- **Hunger**: Below 30 → 50% auto-output penalty
- **Energy**: Affects click power
- **Happiness**: Below 20 → 2x upgrade costs
- **Caffeine**: Bonus resource, decays faster, boosts performance

**Leveling & Skills**:
- Earn XP based on total LoC generated
- XP curve: `100 * 1.3^(level-1)`
- Each level grants 1 skill point
- 4 skills: Typing Speed (+10% click), Code Review (+10% auto), Bug Resistance (-10% enemy dmg), Caffeine Metabolism (-15% decay)

**Equipment** - One-time purchases with permanent effects:
- **Keyboards**: Mechanical (+20% click), Ergonomic (+10% click, -10% energy decay)
- **Chairs**: Gaming (-15% happiness decay), Standing Desk (-10% energy decay)
- **Monitors**: Ultrawide (+15% output), Triple (+25% output)

**Enemies**:
- Spawn periodically on a timer
- Must be clicked to defeat
- Deal damage over time if left alive (steal LoC)
- Different enemy types with varying HP and damage

**Prestige ("Rewrite")**:
- Reset all progress except prestige count
- Gain permanent multiplier to all LoC generation
- Unlocked after reaching certain milestones

### Important Patterns

- **No framework** - Pure vanilla JavaScript with ES6 modules
- **Functional architecture** - No classes, all exports are functions or constants
- **State mutation** - State object is mutated directly; no immutability patterns
- **Centralized updates** - UI changes go through `updateAll()` in `ui.js`
- **PWA setup** - Service worker registered in `main.js` for offline capability
- **Mobile-first** - Designed as a mobile game (touch events, viewport settings)

### PWA Details

- `manifest.json` - App metadata for installation
- `sw.js` - Service worker for offline caching
- Deployed to Vercel (`.vercel/` directory)
